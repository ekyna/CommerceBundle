{% extends '@EkynaAdmin/Entity/Crud/create.html.twig' %}

{% block title %}
    <h1>{{ ((refund ? 'refund' : 'payment') ~ '.header.new')|trans({}, 'EkynaCommerce')|raw }}</h1>
{% endblock title %}

{% block actions %}{% endblock actions %}

{% block main %}
{% apply spaceless %}

    {% if not refund %}
    <p style="font-size:18px;">
    {% set currency = sale.currency.code -%}
    {% set amount = sale|payment_expected_amount -%}
    {% if 0 < sale.depositTotal and amount == sale.depositTotal -%}
        {{- 'checkout.payment.deposit_amount'|trans({
            '%amount%': amount|format_currency(currency)
        }, 'EkynaCommerce')|raw -}}
    {%- else -%}
        {{- 'checkout.payment.remaining_amount'|trans({
            '%amount%': amount|format_currency(currency)
        }, 'EkynaCommerce')|raw -}}
    {%- endif %}
    {% if currency != commerce_default_currency -%}
    <small style="display:inline-block;margin-left:10px;color:#999">
        {{- sale|payment_expected_amount(commerce_default_currency)|format_currency(commerce_default_currency) -}}
        &nbsp;&dash;&nbsp;
        {{- sale|currency_rate -}}
    </small>
    {%- endif %}
    </p>

    <hr>
    {% endif %}

    {% for form in forms -%}
    {% if loop.index0 % 2 == 0 %}<div class="row">{% endif %}
        <div class="col-md-6">
            <div class="panel panel-default">
                <div class="panel-body">
                    {{ bootstrap_set_style('') }}
                    {{ form(form) }}
                </div>
            </div>
        </div>
    {% if loop.last or loop.index0 % 2 == 1 %}</div>{% endif %}
    {%- else -%}
        <div class="alert alert-danger">
            <p>
                <i class="glyphicon glyphicon-alert"></i>&nbsp;
                {{ 'checkout.payment.no_method_available'|trans({}, 'EkynaCommerce') }}
            </p>
        </div>
    {%- endfor %}


    <div class="text-center">
        <a href="{{ admin_resource_path(sale) }}" class="btn btn-default">
            <span class="glyphicon glyphicon-chevron-left"></span>
            {{ 'button.cancel'|trans({}, 'EkynaUi') }}
        </a>
    </div>

    <hr>

    <h4 class="sub-header">
        {{- 'payment.label.plural'|trans({}, 'EkynaCommerce') -}}
    </h4>
    {% include '@EkynaCommerce/Admin/Common/Sale/show_payments.html.twig' with {
        'payments': sale.getPayments(true),
        'prefix': 'payment'
    } %}
    <hr>
    <h4 class="sub-header">
        {{- 'refund.label.plural'|trans({}, 'EkynaCommerce') -}}
    </h4>
    {% include '@EkynaCommerce/Admin/Common/Sale/show_payments.html.twig' with {
        'payments': sale.getPayments(false),
        'prefix': 'refund'
    } %}

{% endapply %}
{% endblock main %}

{% block side %}
    {{ parent() }}
    {% include '@EkynaCommerce/Admin/Common/Sale/Side/sale.html.twig' with {'sale': sale} only %}
{% endblock side %}
