{% extends '@EkynaCommerce/Account/layout.html.twig' %}

{% macro field(label, value, label_col, widget_col, symbol) %}
{% apply spaceless %}
    <div class="form-group form-group-sm">
        <label class="control-label col-md-{{ label_col }} control-label-sm">
            {{- label|trans|raw }}{% if symbol %}&nbsp;{{ symbol|raw }}{% endif -%}
        </label>
        <div class="col-md-{{ widget_col }}">
            <p class="form-control input-sm">
                {{- value|raw -}}
            </p>
        </div>
    </div>
{% endapply %}
{% endmacro field %}

{% import _self as macros %}

{% block account %}
{% apply spaceless %}
    {% do currency_configure(customer) %}

    {% if currency_get_quote() != currency_get_base() -%}
        {% set exchange_symbol = '<strong style="color:red">*</strong>' %}
    {% else %}
        {% set exchange_symbol = null %}
    {% endif %}
    <h3>{{ 'account.information.title'|trans({}, 'EkynaCommerce') }}</h3>

    <hr>

    <div class="form-horizontal">
        {{ macros.field(t('field.email', [], 'EkynaUi'), customer.email, 3, 9) }}
        {{ macros.field(t('field.identity', [], 'EkynaUi'), customer|identity, 3, 9) }}

        {% if commerce_feature(constant('Ekyna\\Component\\Commerce\\Features::BIRTHDAY')) -%}
        <div class="row">
            <div class="col-md-6">
                {{- macros.field(
                    t('field.birthday', [], 'EkynaUi'),
                    customer.birthday ? customer.birthday|format_datetime('short', 'none') : 'value.undefined'|trans({}, 'EkynaUi'),
                    6, 6
                ) -}}
            </div>
        </div>
        {%- endif %}

        <div class="row">
            <div class="col-md-6">
                {{- macros.field(
                    t('field.phone', [], 'EkynaUi'),
                    customer.phone ? phone_number_format(customer.phone) : 'value.undefined'|trans({}, 'EkynaUi'),
                    6, 6
                ) -}}
            </div>
            <div class="col-md-6">
                {{- macros.field(
                    t('field.mobile', [], 'EkynaUi'),
                    customer.mobile ? phone_number_format(customer.mobile) : 'value.undefined'|trans({}, 'EkynaUi'),
                    6, 6
                ) -}}
            </div>
        </div>

        {% set businessCustomer = customer %}
        {% if customer.hasParent() %}
            {% set businessCustomer = customer.parent %}
            <hr>
            {% set parent = (customer.parent|identity) ~ '&nbsp;<em>&lt;' ~ customer.parent.email ~ '&gt;</em>' %}
            {{ macros.field(t('customer.field.parent', [], 'EkynaCommerce'), parent, 3, 9) }}
        {% endif %}
        <div class="row">
            <div class="col-md-6">
                {{- macros.field(t('field.company', [], 'EkynaUi'), businessCustomer.company, 6, 6) -}}
            </div>
            <div class="col-md-6">
                {{- macros.field(
                    t('pricing.field.vat_number', [], 'EkynaCommerce'),
                    businessCustomer.vatNumber ?? 'value.undefined'|trans({}, 'EkynaUi'),
                    6, 6
                ) -}}
            </div>
        </div>

        <hr>

        <div class="row">
            <div class="col-md-6">
                {{- macros.field(t('field.currency', [], 'EkynaUi'), customer.currency, 6, 6) -}}
            </div>
            <div class="col-md-6">
                {{- macros.field(t('field.locale', [], 'EkynaUi'), customer.locale|language|capitalize, 6, 6) -}}
            </div>
        </div>

        {% if businessCustomer.paymentTerm is not null %}
            {{ macros.field(t('payment_term.label.singular', [], 'EkynaCommerce'), businessCustomer.paymentTerm.title, 3, 9) }}
            <div class="row">
                <div class="col-md-6">
                    {{- macros.field(
                        t('sale.field.outstanding_limit', [], 'EkynaCommerce'),
                        businessCustomer.outstandingLimit|currency_base(null, true),
                        6, 6, exchange_symbol
                    ) -}}
                </div>
                <div class="col-md-6">
                    {{- macros.field(
                        t('customer.field.outstanding_balance', [], 'EkynaCommerce'),
                        businessCustomer.outstandingBalance|currency_base(null, true),
                        6, 6, exchange_symbol
                    ) -}}
                </div>
            </div>
        {% endif %}

        {% if not customer.hasParent() %}
        <div class="row">
            <div class="col-md-6">
                {{- macros.field(
                    t('customer.field.credit_balance', [], 'EkynaCommerce'),
                    customer.creditBalance|currency_base(null, true),
                    6, 6, exchange_symbol
                ) -}}
            </div>
        </div>
        {% endif %}

        <div class="form-group form-group-sm">
            <label class="control-label col-md-3 control-label-sm">
                {{ 'notification.label.plural'|trans({}, 'EkynaCommerce') }}
            </label>
            <div class="col-md-9">
                <div class="form-control input-sm" style="height:auto">
                    {{- customer|notifications -}}
                </div>
            </div>
        </div>

    </div>

    {% if currency_get_quote() != currency_get_base() -%}
    <div class="alert alert-warning">
        <p>
            {{- exchange_symbol|raw }} : {{ 'notice.exchange'|trans({}, 'EkynaCommerce')|raw }}
            {{ 'field.exchange_rate'|trans({}, 'EkynaCommerce') }}: {{ currency_rate(null, false, true) }}
        </p>
    </div>
    {%- endif %}

    <hr>

    <p style="text-align:center">
        <a href="{{ path('ekyna_user_account_profile_edit') }}" class="btn btn-primary">
            {{- 'button.edit'|trans({}, 'EkynaUi') -}}
        </a>
    </p>
    {% do currency_configure() %}
{% endapply %}
{% endblock account %}
