<?xml version="1.0" ?>
<container xmlns="http://symfony.com/schema/dic/services"
           xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
           xsi:schemaLocation="http://symfony.com/schema/dic/services http://symfony.com/schema/dic/services/services-1.0.xsd">

    <parameters>
        <parameter key="ekyna_commerce.stock_subject.form_type.builder.class">Ekyna\Bundle\CommerceBundle\Form\StockSubjectFormBuilder</parameter>
    </parameters>

    <services>

        <!-- TODO remove forms defined by resources di builder -->

        <!-- Accounting form types -->
        <service id="ekyna_commerce.accounting_export.form_type"
                 class="Ekyna\Bundle\CommerceBundle\Form\Type\Accounting\ExportType">
            <argument type="service" id="ekyna_resource.locale.request_provider"/>
            <tag name="form.type"/>
        </service>

        <!-- Cart form types -->
        <service id="ekyna_commerce.cart.form_type"
                 class="Ekyna\Bundle\CommerceBundle\Form\Type\Cart\CartType">
            <argument>%ekyna_commerce.cart.class%</argument>
            <argument>%ekyna_commerce.default.currency%</argument>
            <tag name="form.type"/>
        </service>
        <service id="ekyna_commerce.cart_payment.form_type"
                 class="Ekyna\Bundle\CommerceBundle\Form\Type\Cart\CartPaymentType">
            <argument>%ekyna_commerce.cart_payment.class%</argument>
            <argument>%ekyna_commerce.currency.class%</argument>
            <argument>%ekyna_commerce.payment_method.class%</argument>
            <tag name="form.type"/>
        </service>

        <!-- Country form type -->
        <service id="ekyna_commerce.country_choice.form_type"
                 class="Ekyna\Bundle\CommerceBundle\Form\Type\Common\CountryChoiceType">
            <argument type="service" id="ekyna_resource.locale.request_provider"/>
            <argument>%ekyna_commerce.country.class%</argument>
            <argument>%ekyna_commerce.default.country%</argument>
            <tag name="form.type"/>
        </service>

        <!-- Currency form type -->
        <service id="ekyna_commerce.currency_choice.form_type"
                 class="Ekyna\Bundle\CommerceBundle\Form\Type\Common\CurrencyChoiceType">
            <argument>%ekyna_commerce.currency.class%</argument>
            <argument>%ekyna_commerce.default.currency%</argument>
            <tag name="form.type"/>
        </service>

        <!-- Customer form types -->
        <service id="ekyna_commerce.customer.form_type"
                 class="Ekyna\Bundle\CommerceBundle\Form\Type\Customer\CustomerType">
            <argument>%ekyna_commerce.customer.class%</argument>
            <tag name="form.type"/>
            <tag name="form.js" selector="form[name=customer]" path="ekyna-commerce/form/customer"/>
        </service>
        <service id="ekyna_commerce.customer_address.form_type"
                 class="Ekyna\Bundle\CommerceBundle\Form\Type\Customer\CustomerAddressType">
            <argument>%ekyna_commerce.customer_address.class%</argument>
            <argument>%ekyna_commerce.customer.class%</argument>
            <tag name="form.type"/>
        </service>
        <service id="ekyna_commerce.customer_search.form_type"
                 class="Ekyna\Bundle\CommerceBundle\Form\Type\Customer\CustomerSearchType">
            <argument>%ekyna_commerce.customer.class%</argument>
            <tag name="form.type"/>
        </service>
        <service id="ekyna_commerce.customer_group_choice.form_type"
                 class="Ekyna\Bundle\CommerceBundle\Form\Type\Customer\CustomerGroupChoiceType">
            <argument>%ekyna_commerce.customer_group.class%</argument>
            <tag name="form.type"/>
        </service>

        <!-- Account form types -->
        <service id="ekyna_commerce.account.registration.form_type"
                 class="Ekyna\Bundle\CommerceBundle\Form\Type\Account\RegistrationType">
            <argument type="service" id="security.token_storage"/>
            <argument>%ekyna_commerce.customer.class%</argument>
            <argument>%ekyna_commerce.default.customer%</argument>
            <tag name="form.type"/>
            <tag name="form.js" selector="form[name=registration]" path="ekyna-commerce/form/registration"/>
        </service>
        <service id="ekyna_commerce.account.information.form_type"
                 class="Ekyna\Bundle\CommerceBundle\Form\Type\Account\InformationType">
            <argument>%ekyna_commerce.customer.class%</argument>
            <argument>%ekyna_commerce.default.customer%</argument>
            <tag name="form.type"/>
        </service>

        <!-- Identity form type -->
        <service id="ekyna_commerce.gender.form_type"
                 class="Ekyna\Bundle\CommerceBundle\Form\Type\Common\GenderType">
            <argument>%ekyna_commerce.genders.class%</argument>
            <tag name="form.type"/>
        </service>
        <service id="ekyna_commerce.identity.form_type"
                 class="Ekyna\Bundle\CommerceBundle\Form\Type\Common\IdentityType">
            <argument>%ekyna_commerce.genders.class%</argument>
            <tag name="form.type"/>
        </service>

        <!-- Notification form type -->
        <service id="ekyna_commerce.notify.form_type"
                 class="Ekyna\Bundle\CommerceBundle\Form\Type\Notify\NotifyType">
            <argument type="service" id="ekyna_commerce.notify.recipient_helper"/>
            <argument type="service" id="translator"/>
            <tag name="form.type"/>
        </service>

        <!-- Order form types -->
        <service id="ekyna_commerce.order.form_type"
                 class="Ekyna\Bundle\CommerceBundle\Form\Type\Order\OrderType">
            <argument>%ekyna_commerce.order.class%</argument>
            <argument>%ekyna_commerce.default.currency%</argument>
            <tag name="form.type"/>
        </service>
        <service id="ekyna_commerce.order_payment.form_type"
                 class="Ekyna\Bundle\CommerceBundle\Form\Type\Order\OrderPaymentType">
            <argument>%ekyna_commerce.order_payment.class%</argument>
            <argument>%ekyna_commerce.currency.class%</argument>
            <argument>%ekyna_commerce.payment_method.class%</argument>
            <tag name="form.type"/>
        </service>
        <service id="ekyna_commerce.order_shipment.form_type"
                 class="Ekyna\Bundle\CommerceBundle\Form\Type\Order\OrderShipmentType">
            <argument type="service" id="ekyna_commerce.shipment.builder"/>
            <argument type="service" id="security.authorization_checker"/>
            <argument>%ekyna_commerce.order_shipment.class%</argument>
            <argument>%ekyna_commerce.default.currency%</argument>
            <tag name="form.type"/>
            <tag name="form.js" selector=".shipment" path="ekyna-commerce/form/shipment"/>
        </service>
        <service id="ekyna_commerce.order_shipment_parcel.form_type"
                 class="Ekyna\Bundle\CommerceBundle\Form\Type\Order\OrderShipmentParcelType">
            <argument>%ekyna_commerce.order_shipment_parcel.class%</argument>
            <argument>%ekyna_commerce.default.currency%</argument>
            <tag name="form.type"/>
        </service>
        <service id="ekyna_commerce.order_invoice.form_type"
                 class="Ekyna\Bundle\CommerceBundle\Form\Type\Order\OrderInvoiceType">
            <argument type="service" id="ekyna_commerce.invoice.builder"/>
            <argument>%ekyna_commerce.order_invoice.class%</argument>
            <tag name="form.type"/>
            <tag name="form.js" selector=".invoice" path="ekyna-commerce/form/invoice"/>
        </service>

        <!-- Price form type -->
        <service id="ekyna_commerce.price.form_type"
                 class="Ekyna\Bundle\CommerceBundle\Form\Type\Pricing\PriceType">
            <argument>%ekyna_commerce.default.currency%</argument>
            <argument>%ekyna_commerce.default.vat_display_mode%</argument>
            <tag name="form.type"/>
            <tag name="form.js" selector=".commerce-price" path="ekyna-commerce/form/price"/>
        </service>

        <!-- Quote form types -->
        <service id="ekyna_commerce.quote.form_type"
                 class="Ekyna\Bundle\CommerceBundle\Form\Type\Quote\QuoteType">
            <argument>%ekyna_commerce.quote.class%</argument>
            <argument>%ekyna_commerce.default.currency%</argument>
            <tag name="form.type"/>
        </service>
        <service id="ekyna_commerce.quote_payment.form_type"
                 class="Ekyna\Bundle\CommerceBundle\Form\Type\Quote\QuotePaymentType">
            <argument>%ekyna_commerce.quote_payment.class%</argument>
            <argument>%ekyna_commerce.currency.class%</argument>
            <argument>%ekyna_commerce.payment_method.class%</argument>
            <tag name="form.type"/>
        </service>

        <!-- Payment form types -->
        <service id="ekyna_commerce.checkout_payment.form_type"
                 class="Ekyna\Bundle\CommerceBundle\Form\Type\Checkout\PaymentType">
            <argument type="service" id="translator"/>
            <tag name="form.type"/>
        </service>
        <service id="ekyna_commerce.payment_method.form_type"
                 class="Ekyna\Bundle\CommerceBundle\Form\Type\Payment\PaymentMethodType">
            <argument>%ekyna_commerce.payment_method.class%</argument>
            <argument type="service" id="payum"/>
            <tag name="form.type"/>
        </service>
        <service id="ekyna_commerce.payment_term_choice.form_type"
                 class="Ekyna\Bundle\CommerceBundle\Form\Type\Payment\PaymentTermChoiceType">
            <argument>%ekyna_commerce.payment_term.class%</argument>
            <tag name="form.type"/>
        </service>
        <service id="ekyna_commerce.payment_method_choice.form_type"
                 class="Ekyna\Bundle\CommerceBundle\Form\Type\Payment\PaymentMethodChoiceType">
            <argument>%ekyna_commerce.payment_method.class%</argument>
            <tag name="form.type"/>
        </service>
        <service id="ekyna_commerce.payment_method_factory_choice.form_type"
                 class="Ekyna\Bundle\CommerceBundle\Form\Type\Payment\PaymentMethodFactoryChoiceType">
            <argument>%ekyna_commerce.payment_method.class%</argument>
            <tag name="form.type"/>
        </service>

        <!-- Payment method create form flow -->
        <service id="ekyna_commerce.payment_method.create_form_flow"
                 class="Ekyna\Bundle\CommerceBundle\Form\PaymentMethodCreateFlow"
                 parent="craue.form.flow">
        </service>

        <!-- Relay point form type -->
        <service id="ekyna_commerce.relay_point.form_type"
                 class="Ekyna\Bundle\CommerceBundle\Form\Type\Shipment\RelayPointType">
            <argument type="service" id="ekyna_commerce.relay_point.repository"/>
            <argument type="service" id="serializer"/>
            <argument>%google.map_api_key%</argument>
            <tag name="form.type"/>
            <tag name="form.js" selector=".commerce-relay-point" path="ekyna-commerce/form/relay-point"/>
        </service>

        <!-- Shipment gateway data type -->
        <service id="ekyna_commerce.shipment_gateway_data.form_type"
                 class="Ekyna\Bundle\CommerceBundle\Form\Type\Shipment\GatewayDataType">
            <argument type="service" id="ekyna_commerce.shipment.gateway_registry"/>
            <tag name="form.type"/>
            <tag name="form.js" selector=".commerce-shipment-gateway-data" path="ekyna-commerce/form/shipment-gateway-data"/>
        </service>

        <!-- Shipment address form type -->
        <service id="ekyna_commerce.shipment_address.form_type"
                 class="Ekyna\Bundle\CommerceBundle\Form\Type\Shipment\ShipmentAddressType">
            <argument type="service" id="ekyna_commerce.shipment_address.transformer"/>
            <argument type="service" id="validator"/>
            <tag name="form.type"/>
        </service>

        <!-- Shipment method form type -->
        <service id="ekyna_commerce.shipment_method.form_type"
                 class="Ekyna\Bundle\CommerceBundle\Form\Type\Shipment\ShipmentMethodType">
            <argument>%ekyna_commerce.shipment_method.class%</argument>
            <argument type="service" id="ekyna_commerce.shipment.gateway_registry"/>
            <tag name="form.type"/>
        </service>
        <!-- Shipment method choice form type -->
        <service id="ekyna_commerce.shipment_method_choice.form_type"
                 class="Ekyna\Bundle\CommerceBundle\Form\Type\Shipment\ShipmentMethodChoiceType">
            <argument>%ekyna_commerce.shipment_method.class%</argument>
            <tag name="form.type"/>
        </service>
        <!-- Shipment method choice form type -->
        <service id="ekyna_commerce.shipment_method_pick.form_type"
                 class="Ekyna\Bundle\CommerceBundle\Form\Type\Shipment\ShipmentMethodPickType">
            <argument type="service" id="ekyna_commerce.shipment_price.resolver"/>
            <argument type="service" id="ekyna_commerce.shipment.gateway_registry"/>
            <argument type="service" id="ekyna_commerce.shipment_method.repository"/>
            <argument type="service" id="ekyna_commerce.common.context_provider"/>
            <argument type="service" id="ekyna_commerce.util.formatter.default"/>
            <argument type="service" id="translator"/>
            <tag name="form.type"/>
        </service>
        <!-- Shipment pricing type -->
        <service id="ekyna_commerce.shipment_pricing.form_type"
                 class="Ekyna\Bundle\CommerceBundle\Form\Type\Shipment\ShipmentPricingType">
            <argument>%ekyna_commerce.shipment_zone.class%</argument>
            <argument>%ekyna_commerce.shipment_method.class%</argument>
            <tag name="form.type"/>
            <tag name="form.js" selector=".commerce-shipment-pricing" path="ekyna-commerce/form/shipment-pricing"/>
        </service>
        <!-- Shipment price type -->
        <service id="ekyna_commerce.shipment_price.form_type"
                 class="Ekyna\Bundle\CommerceBundle\Form\Type\Shipment\ShipmentPriceType">
            <argument>%ekyna_commerce.shipment_price.class%</argument>
            <argument>%ekyna_commerce.shipment_zone.class%</argument>
            <argument>%ekyna_commerce.shipment_method.class%</argument>
            <tag name="form.type"/>
        </service>
        <!-- Shipment rule type -->
        <service id="ekyna_commerce.shipment_rule.form_type"
                 class="Ekyna\Bundle\CommerceBundle\Form\Type\Shipment\ShipmentRuleType">
            <argument>%ekyna_commerce.shipment_rule.class%</argument>
            <argument>%ekyna_commerce.default.currency%</argument>
            <tag name="form.type"/>
        </service>
        <!-- Shipment factory choice type -->
        <service id="ekyna_commerce.shipment_platform_choice.form_type"
                 class="Ekyna\Bundle\CommerceBundle\Form\Type\Shipment\ShipmentPlatformChoiceType">
            <argument type="service" id="ekyna_commerce.shipment.gateway_registry"/>
            <tag name="form.type"/>
        </service>
        <!-- Shipment method factory choice type -->
        <service id="ekyna_commerce.shipment_method_factory_choice.form_type"
                 class="Ekyna\Bundle\CommerceBundle\Form\Type\Shipment\ShipmentMethodFactoryChoiceType">
            <argument>%ekyna_commerce.shipment_method.class%</argument>
            <tag name="form.type"/>
        </service>

        <!-- Shipment method create form flow -->
        <service id="ekyna_commerce.shipment_method.create_form_flow"
                 class="Ekyna\Bundle\CommerceBundle\Form\ShipmentMethodCreateFlow"
                 parent="craue.form.flow">
        </service>

        <!-- Stock subject form type builder -->
        <service id="ekyna_commerce.stock_subject.form_type.builder"
                 class="%ekyna_commerce.stock_subject.form_type.builder.class%"/>

        <!-- (Relative) Subject choice type -->
        <service id="ekyna_commerce.subject_choice.form_type"
                 class="Ekyna\Bundle\CommerceBundle\Form\Type\Subject\SubjectChoiceType">
            <argument type="service" id="ekyna_commerce.subject.provider_registry"/>
            <argument type="service" id="ekyna_resource.configuration_registry"/>
            <argument type="service" id="router"/>
            <tag name="form.type"/>
            <tag name="form.js" selector=".commerce-subject-choice" path="ekyna-commerce/form/subject-choice"/>
        </service>

        <!-- Supplier address type -->
        <service id="ekyna_commerce.supplier_address.form_type"
                 class="Ekyna\Bundle\CommerceBundle\Form\Type\Supplier\SupplierAddressType">
            <argument>%ekyna_commerce.supplier_address.class%</argument>
            <tag name="form.type"/>
        </service>

        <!-- Supplier type -->
        <service id="ekyna_commerce.supplier.form_type"
                 class="Ekyna\Bundle\CommerceBundle\Form\Type\Supplier\SupplierType">
            <argument type="service" id="ekyna_commerce.supplier_product.repository"/>
            <argument>%ekyna_commerce.supplier.class%</argument>
            <argument>%ekyna_commerce.supplier_carrier.class%</argument>
            <tag name="form.type"/>
        </service>
        <!-- Supplier choice form type -->
        <service id="ekyna_product.supplier_choice.form_type"
                 class="Ekyna\Bundle\CommerceBundle\Form\Type\Supplier\SupplierChoiceType">
            <argument>%ekyna_commerce.supplier.class%</argument>
            <tag name="form.type"/>
        </service>
        <!-- Supplier delivery item type -->
        <service id="ekyna_commerce.supplier_delivery.form_type"
                 class="Ekyna\Bundle\CommerceBundle\Form\Type\Supplier\SupplierDeliveryType">
            <argument type="service" id="ekyna_commerce.supplier_delivery_item.repository"/>
            <argument type="service" id="ekyna_commerce.subject_helper"/>
            <argument>%ekyna_commerce.supplier_delivery.class%</argument>
            <tag name="form.type"/>
            <tag name="form.js" selector=".commerce-supplier-delivery" path="ekyna-commerce/form/supplier-delivery"/>
        </service>
        <!-- Supplier order type -->
        <service id="ekyna_commerce.supplier_order.form_type"
                 class="Ekyna\Bundle\CommerceBundle\Form\Type\Supplier\SupplierOrderType">
            <argument>%ekyna_commerce.supplier_order.class%</argument>
            <argument>%ekyna_commerce.supplier.class%</argument>
            <argument>%ekyna_commerce.supplier_product.class%</argument>
            <argument>%ekyna_commerce.supplier_carrier.class%</argument>
            <argument>%ekyna_commerce.default.currency%</argument>
            <tag name="form.type"/>
            <tag name="form.js" selector=".commerce-supplier-order" path="ekyna-commerce/form/supplier-order"/>
            <tag name="form.js" selector=".commerce-supplier-order" path="ekyna-commerce/form/supplier-order-compose"/>
        </service>
        <!-- Supplier order items type -->
        <service id="ekyna_commerce.supplier_order_items.form_type"
                 class="Ekyna\Bundle\CommerceBundle\Form\Type\Supplier\SupplierOrderItemsType">
            <argument type="service" id="ekyna_commerce.supplier_order_item.repository"/>
            <tag name="form.type"/>
        </service>
        <!-- Supplier order item type -->
        <service id="ekyna_commerce.supplier_order_item.form_type"
                 class="Ekyna\Bundle\CommerceBundle\Form\Type\Supplier\SupplierOrderItemType">
            <argument>%ekyna_commerce.supplier_order_item.class%</argument>
            <argument>%ekyna_commerce.supplier_product.class%</argument>
            <tag name="form.type"/>
        </service>
        <!-- Supplier order compose type -->
        <!--<service id="ekyna_commerce.supplier_order_compose.form_type"
                 class="Ekyna\Bundle\CommerceBundle\Form\Type\Supplier\SupplierOrderComposeType">
            <argument>%ekyna_commerce.supplier_product.class%</argument>
            <tag name="form.type"/>
        </service>-->
        <!-- Supplier order create form flow -->
        <service id="ekyna_commerce.supplier_order.create_form_flow"
                 class="Ekyna\Bundle\CommerceBundle\Form\SupplierOrderCreateFlow"
                 parent="craue.form.flow">
            <argument type="service" id="ekyna_commerce.supplier_order.operator"/>
        </service>
        <!-- Supplier order compose type -->
        <service id="ekyna_commerce.supplier_order_submit.form_type"
                 class="Ekyna\Bundle\CommerceBundle\Form\Type\Supplier\SupplierOrderSubmitType">
            <argument>%ekyna_commerce.supplier_order.class%</argument>
            <argument>%ekyna_commerce.supplier_carrier.class%</argument>
            <argument>%ekyna_commerce.default.currency%</argument>
            <tag name="form.type"/>
            <tag name="form.js" selector=".commerce-supplier-submit" path="ekyna-commerce/form/supplier-order"/>
        </service>
        <!-- Supplier order template form type -->
        <service id="ekyna_product.supplier_order_template.form_type"
                 class="Ekyna\Bundle\CommerceBundle\Form\Type\Supplier\SupplierOrderTemplateType">
            <tag name="form.type"/>
            <tag name="form.js" selector=".commerce-supplier-order-template" path="ekyna-commerce/form/supplier-order-template"/>
        </service>

        <!-- Sale add item form flow -->
        <service id="ekyna_commerce.sale_item_create.form_flow"
                 class="Ekyna\Bundle\CommerceBundle\Form\Type\Sale\SaleItemCreateFlow"
                 parent="craue.form.flow"/>

        <!-- Sale item subject form type -->
        <service id="ekyna_commerce.sale_address.form_type"
                 class="Ekyna\Bundle\CommerceBundle\Form\Type\Sale\SaleAddressType">
            <argument type="service" id="serializer"/>
            <argument type="service" id="ekyna_commerce.customer.repository"/>
            <argument type="service" id="ekyna_commerce.customer_address.repository"/>
            <tag name="form.type"/>
            <tag name="form.js" selector=".commerce-sale-address" path="ekyna-commerce/form/sale-address"/>
        </service>

        <!-- Sale item subject form type -->
        <service id="ekyna_commerce.sale_item_subject.form_type"
                 class="Ekyna\Bundle\CommerceBundle\Form\Type\Sale\SaleItemSubjectType">
            <tag name="form.type"/>
            <tag name="form.js" selector=".commerce-sale-item-subject" path="ekyna-commerce/form/sale-item-subject"/>
        </service>
        <!-- Sale item configure form type -->
        <service id="ekyna_commerce.sale_item_configure.form_type"
                 class="Ekyna\Bundle\CommerceBundle\Form\Type\Sale\SaleItemConfigureType">
            <argument type="service" id="event_dispatcher"/>
            <tag name="form.type"/>
        </service>

        <!-- Sale shipment form type -->
        <service id="ekyna_commerce.sale_shipment.form_type"
                 class="Ekyna\Bundle\CommerceBundle\Form\Type\Sale\SaleShipmentType">
            <argument type="service" id="ekyna_commerce.shipment_price.resolver"/>
            <tag name="form.type"/>
            <tag name="form.js" selector=".commerce-sale-shipment" path="ekyna-commerce/form/sale-shipment"/>
        </service>

        <!-- Pricing form types -->
        <service id="ekyna_commerce.tax_choice.form_type"
                 class="Ekyna\Bundle\CommerceBundle\Form\Type\Pricing\TaxChoiceType">
            <argument>%ekyna_commerce.tax.class%</argument>
            <tag name="form.type"/>
        </service>
        <service id="ekyna_commerce.tax_group_choice.form_type"
                 class="Ekyna\Bundle\CommerceBundle\Form\Type\Pricing\TaxGroupChoiceType">
            <argument type="service" id="ekyna_commerce.country.repository"/>
            <argument>%ekyna_commerce.tax_group.class%</argument>
            <tag name="form.type"/>
        </service>
        <service id="ekyna_commerce.tax_rule_choice.form_type"
                 class="Ekyna\Bundle\CommerceBundle\Form\Type\Pricing\TaxRuleChoiceType">
            <argument>%ekyna_commerce.tax_rule.class%</argument>
            <tag name="form.type"/>
        </service>

        <!-- Vat number form type -->
        <service id="ekyna_commerce.vat_number.form_type"
                 class="Ekyna\Bundle\CommerceBundle\Form\Type\Pricing\VatNumberType">
            <argument type="service" id="router"/>
            <argument type="service" id="templating"/>
            <tag name="form.type"/>
            <tag name="form.js" selector=".commerce-vat-number" path="ekyna-commerce/form/vat-number"/>
        </service>

    </services>

</container>
