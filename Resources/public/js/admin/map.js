define(["jquery","routing"],function(r,s){var a,o,l,i,n,y=!1;function e(){a=window.commerceMap,o=window.commerceMarkerCluster,l=window.commerceHeatmap,(i=r('form[name="map"]')).on("submit",function(e){return e.preventDefault(),e.stopPropagation(),t(),!1}),function(){var e=document.getElementById("map_search");try{var t=new google.maps.places.Autocomplete(e,{types:["(regions)"]})}catch(e){return console.log("Failed to load autocomplete")}t.bindTo("bounds",a),t.addListener("place_changed",function(){var e=t.getPlace();e.geometry?a.setCenter(e.geometry.location):console.log("Autocomplete's returned place contains no geometry")})}(),t()}function t(){var e;y||(y=!0,e=i.serialize(),i.find("input, select, button").prop("disabled",!0),r.ajax({url:s.generate("admin_ekyna_commerce_map_data"),method:"GET",data:e,dataType:"json"}).done(function(e){var t;e.hasOwnProperty("locations")&&(o.clearMarkers(),"order"===i.find('[name="map[mode]"]').val()?(t=e.locations,o.clearMarkers(),a.setOptions({styles:f}),l.setData(t.map(function(e){return{location:new google.maps.LatLng(e.lat,e.lng),weight:e.weight}})),l.setMap(a)):(t=e.locations,l.setData([]),l.setMap(null),a.setOptions({styles:m}),o.clearMarkers(),t.forEach(function(e){var l=new google.maps.Marker(e);l.addListener("click",function(){var t=l;n&&(n.close(),n=null),t.infoWindowContent?(n=new google.maps.InfoWindow({content:t.infoWindowContent})).open(a,t):r.ajax({url:s.generate("admin_ekyna_commerce_map_info"),method:"GET",data:{customerId:t.customerId},dataType:"html"}).done(function(e){t.infoWindowContent=e,(n=new google.maps.InfoWindow({content:e})).open(a,t)})}),o.addMarker(l)})),y=!1,i.find("input, select, button").prop("disabled",!1))}))}var p=setInterval(function(){var t;t=!0,["commerceMap","commerceMarkerCluster","commerceHeatmap"].forEach(function(e){if(!window.hasOwnProperty(e)||void 0===window[e])return t=!1}),t&&(clearInterval(p),e())},250),m=[{featureType:"all",elementType:"labels.text.fill",stylers:[{saturation:36},{color:"#333333"},{lightness:40}]},{featureType:"all",elementType:"labels.text.stroke",stylers:[{visibility:"on"},{color:"#ffffff"},{lightness:16}]},{featureType:"all",elementType:"labels.icon",stylers:[{visibility:"off"}]},{featureType:"administrative",elementType:"geometry.fill",stylers:[{color:"#fefefe"},{lightness:20}]},{featureType:"administrative",elementType:"geometry.stroke",stylers:[{color:"#fefefe"},{lightness:17},{weight:1.2}]},{featureType:"administrative.locality",elementType:"labels",stylers:[{visibility:"on"}]},{featureType:"administrative.locality",elementType:"labels.icon",stylers:[{visibility:"on"},{color:"#b6b6b6"},{weight:"0.20"}]},{featureType:"landscape",elementType:"geometry",stylers:[{color:"#ffffff"},{lightness:20}]},{featureType:"poi",elementType:"all",stylers:[{visibility:"off"}]},{featureType:"poi.park",elementType:"labels",stylers:[{visibility:"off"}]},{featureType:"road.highway",elementType:"geometry.fill",stylers:[{color:"#dedede"},{lightness:17}]},{featureType:"road.highway",elementType:"geometry.stroke",stylers:[{color:"#dedede"},{lightness:29},{weight:.2}]},{featureType:"road.arterial",elementType:"geometry",stylers:[{lightness:18},{color:"#dedede"}]},{featureType:"road.local",elementType:"geometry",stylers:[{color:"#e3e3e3"},{lightness:16}]},{featureType:"water",elementType:"geometry",stylers:[{color:"#a0d6d1"},{lightness:17}]},{featureType:"water",elementType:"labels",stylers:[{visibility:"off"}]}],f=[{featureType:"all",elementType:"labels.text.fill",stylers:[{saturation:36},{color:"#000000"},{lightness:40}]},{featureType:"all",elementType:"labels.text.stroke",stylers:[{visibility:"on"},{color:"#000000"},{lightness:16}]},{featureType:"all",elementType:"labels.icon",stylers:[{visibility:"off"}]},{featureType:"administrative",elementType:"geometry.fill",stylers:[{color:"#000000"},{lightness:20}]},{featureType:"administrative",elementType:"geometry.stroke",stylers:[{color:"#000000"},{lightness:17},{weight:1.2}]},{featureType:"administrative.locality",elementType:"labels",stylers:[{visibility:"on"},{lightness:"0"}]},{featureType:"administrative.locality",elementType:"labels.text.fill",stylers:[{lightness:"-10"}]},{featureType:"administrative.locality",elementType:"labels.text.stroke",stylers:[{lightness:"-10"}]},{featureType:"administrative.locality",elementType:"labels.icon",stylers:[{color:"#737373"}]},{featureType:"landscape",elementType:"geometry",stylers:[{color:"#000000"},{lightness:20}]},{featureType:"landscape.natural",elementType:"all",stylers:[{visibility:"on"}]},{featureType:"poi",elementType:"geometry",stylers:[{color:"#000000"},{lightness:21}]},{featureType:"road.highway",elementType:"geometry.fill",stylers:[{lightness:17},{color:"#3c3c3c"}]},{featureType:"road.highway",elementType:"geometry.stroke",stylers:[{lightness:29},{weight:.2},{visibility:"off"}]},{featureType:"road.arterial",elementType:"geometry",stylers:[{lightness:18},{color:"#393939"}]},{featureType:"road.local",elementType:"geometry",stylers:[{color:"#000000"},{lightness:16}]},{featureType:"transit",elementType:"all",stylers:[{visibility:"off"}]},{featureType:"transit",elementType:"geometry",stylers:[{color:"#000000"},{lightness:19}]},{featureType:"water",elementType:"geometry",stylers:[{color:"#000000"},{lightness:17}]},{featureType:"water",elementType:"labels",stylers:[{lightness:"0"},{visibility:"off"}]},{featureType:"water",elementType:"labels.text",stylers:[{lightness:"0"}]}]});