define(["jquery","ekyna-modal","ekyna-commerce/templates","ekyna-ui","ekyna-polyfill"],function(a,b,c){function d(){var a=new Date,b=""+(a.getMonth()+1),c=""+a.getDate(),d=a.getFullYear();return b.length<2&&(b="0"+b),c.length<2&&(c="0"+c),[d,b,c].join("-")}function e(a){this.$element=a,this.$element.data("customerBalance",this),this.$form=this.$element.find("form"),this.$table=this.$element.find("table"),this.$from=this.$form.find('input[name="balance[from]"]'),this.$to=this.$form.find('input[name="balance[to]"]'),this.$filter=this.$form.find('select[name="balance[filter]"]'),this.$submit=this.$form.find('button[name="balance[submit]"]'),this.init()}return e.prototype.init=function(){this.bindEvents()},e.prototype.bindEvents=function(){this.$submit.on("click",a.proxy(this.filter,this))},e.prototype.unbindEvents=function(){this.$submit.off("click")},e.prototype.update=function(b){b.preventDefault(),b.stopPropagation();var d=this.$element;return this.$element.loadingSpinner(),this.$form.ajaxSubmit({dataType:"json",success:function(b){var e=c["@EkynaCommerce/Js/customer_balance_rows.html.twig"].render({balance:b});d.find("tbody").replaceWith(a(e))},complete:function(){d.loadingSpinner("off")}}),!1},e.prototype.filter=function(b){b.preventDefault(),b.stopPropagation(),this.$element.loadingSpinner(),this.$table.find("> tbody > tr").show();var c,e=this.$from.val(),f=this.$to.val(),g=this.$filter.val(),h=0,i=0,j=d();return this.$table.find("> tbody > tr").each(function(b,c){var d=a(c),k=d.data("date");if(e||f){if(e&&e>k)return d.hide(),!0;if(f&&f<k)return d.hide(),!0}if("all"!==g){if("invoice"!==d.data("type")||!d.data("due"))return d.hide(),!0;if("due_invoices"===g){if(k>j)return d.hide(),!0}else if("befall_invoices"===g&&k<=j)return d.hide(),!0}i+=parseFloat(a(c).data("debit")),h+=parseFloat(a(c).data("credit"))}),c=h-i,this.$table.find("> tfoot .debit-total").text(i.localizedCurrency("EUR")),this.$table.find("> tfoot .credit-total").text(h.localizedCurrency("EUR")),this.$table.find("> tfoot .balance-total").text(c.localizedCurrency("EUR")),this.$element.loadingSpinner("off"),!1},a.fn.customerBalance=function(){return this.each(function(){void 0===a(this).data("customerBalance")&&new e(a(this))})},a(".customer-balance").customerBalance(),e});