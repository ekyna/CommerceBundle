define(["jquery","ekyna-modal","ekyna-commerce/templates","ekyna-ui","ekyna-polyfill"],function(a,b,c){function d(a){this.$element=a,this.$element.data("customerBalance",this),this.$form=this.$element.find("form"),this.$submit=this.$form.find('button[name="balance[submit]"]'),this.$table=this.$element.find("table"),this.$notDone=this.$form.find('input[name="balance[notDone]"]'),this.init()}return d.prototype.init=function(){this.bindEvents()},d.prototype.bindEvents=function(){this.$submit.on("click",this.update.bind(this)),this.$notDone.on("change",this.toggleDone.bind(this))},d.prototype.unbindEvents=function(){this.$submit.off("click"),this.$notDone.off("change")},d.prototype.update=function(b){b.preventDefault(),b.stopPropagation();var d=this.$element;return this.$element.loadingSpinner(),this.$form.ajaxSubmit({dataType:"json",success:function(b){var e=c["@EkynaCommerce/Js/customer_balance_rows.html.twig"].render({balance:b});d.find("tbody").replaceWith(a(e))},complete:function(){d.loadingSpinner("off")}}),!1},d.prototype.toggleDone=function(){this.$table.find("> tbody > tr").show(),this.$notDone.is(":checked")&&this.$table.find('> tbody > tr[data-done="1"]').hide();var b=0,c=0,d=0;this.$table.find("> tbody > tr:visible").each(function(d,e){c+=parseFloat(a(e).data("debit")),b+=parseFloat(a(e).data("credit"))}),d=b-c,this.$table.find("> tfoot .debit-total").text(c.localizedCurrency("EUR")),this.$table.find("> tfoot .credit-total").text(b.localizedCurrency("EUR")),this.$table.find("> tfoot .balance-total").text(d.localizedCurrency("EUR"))},a.fn.customerBalance=function(){return this.each(function(){void 0===a(this).data("customerBalance")&&new d(a(this))})},a(".customer-balance").customerBalance(),d});