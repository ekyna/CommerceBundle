define(["jquery","routing","ekyna-form","ekyna-spinner"],function(a,b,c){"use strict";return a.fn.gatewayDataWidget=function(){return this.each(function(){function d(){g&&(g.abort(),g=null);var d=parseInt(f.val())||0;if(0>=d)return void e.empty();e.loadingSpinner();var h=e.data("shipment"),i={orderId:e.data("order"),shipmentMethodId:d,"return":e.data("return")};h&&(i.shipmentId=h),g=a.ajax({url:b.generate("admin_ekyna_commerce_order_shipment_gateway_form",i),dataType:"xml"}),g.done(function(b){e.loadingSpinner("off"),e.empty();var d=a(b).find("form");if(1===d.length){e.append(a(d.text()).children());var f=c.create(e);f.init()}})}var e=a(this),f=e.closest("form").find(e.data("method")),g=null;1===f.length&&f.on("change",d)}),this},{init:function(a){a.gatewayDataWidget()}}});