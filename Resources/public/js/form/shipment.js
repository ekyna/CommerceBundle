define(["jquery","ekyna-form/collection"],function(r){"use strict";return r.fn.shipmentWidget=function(){return this.each(function(){const i=r(this),n=i.attr("name"),t=i.find(".shipment-items > tbody > tr input"),a=i.find('[name="'+n+'[method]"]'),o=i.find("#shipment-parcels"),c=i.find("#toggle-general"),l=i.find("#toggle-relay-point"),e=i.find("#toggle-quantities");function d(){const n=a.find('option[value="'+a.val()+'"]');let t=0,e=0;1===n.length&&(t=n.data("parcel"),e=n.data("relay")),t?o.slideDown():o.slideUp(function(){o.find(".ekyna-collection-child-container").empty()}),e?l.show():(l.hide(),c.trigger("click"))}function s(){o.find(".parcel-index").each(function(n,t){r(t).text(n+1)})}a.on("change",d),d();o.on("ekyna-collection-field-added ekyna-collection-field-removed ekyna-collection-field-moved-up ekyna-collection-field-moved-down",s),s(),t.on("blur",function(){const n=r(this),t=parseInt(n.val());isNaN(t)&&n.val(0).trigger("change")}).on("change keyup",function(){const n=r(this),t=i.find('.shipment-items > tbody > tr input[data-parent="'+n.attr("id")+'"]');let e=parseInt(n.val());(e=isNaN(e)?0:e)>n.data("max")?n.closest("tr").addClass("has-error danger"):n.closest("tr").removeClass("has-error danger"),t.each(function(){const n=r(this);n.val(e*n.data("quantity")).trigger("change")})}),e.on("click",function(){let i=0,a=0;t.each(function(n,t){const e=r(t);i+=parseFloat(e.val()),a+=e.data("max")}),(.5<i/a?t.not(":disabled").each(function(n,t){r(t).val(0)}):t.not(":disabled").each(function(n,t){const e=r(t);e.val(e.data("max"))})).trigger("change")})}),this},{init:function(n){n.shipmentWidget()}}});