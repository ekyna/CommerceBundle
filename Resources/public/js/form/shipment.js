define(["jquery","ekyna-form/collection"],function(l){"use strict";return l.fn.shipmentWidget=function(){return this.each(function(){function n(){var n=0,e=0,t=o.find('option[value="'+o.val()+'"]');1===t.length&&(n=t.data("parcel"),e=t.data("relay")),n?c.slideDown():c.slideUp(function(){c.find(".ekyna-collection-child-container").empty()}),e?d.show():(d.hide(),r.trigger("click"))}function e(){c.find(".parcel-index").each(function(n,e){l(e).text(n+1)})}var a=l(this),t=a.attr("name"),i=a.find(".shipment-items > tbody > tr input"),o=a.find('[name="'+t+'[method]"]'),c=a.find("#shipment-parcels"),r=a.find("#toggle-general"),d=a.find("#toggle-relay-point"),t=a.find("#toggle-quantities");o.on("change",n),n();c.on("ekyna-collection-field-added ekyna-collection-field-removed ekyna-collection-field-moved-up ekyna-collection-field-moved-down",e),e(),i.on("blur",function(){var n=l(this),e=parseInt(n.val());isNaN(e)&&n.val(0).trigger("change")}).on("change keyup",function(){var n=l(this),e=parseInt(n.val()),t=a.find('.shipment-items > tbody > tr input[data-parent="'+n.attr("id")+'"]');(e=isNaN(e)?0:e)>n.data("max")?n.closest("tr").addClass("has-error danger"):n.closest("tr").removeClass("has-error danger"),t.each(function(){var n=l(this);n.val(e*n.data("quantity")).trigger("change")})}).not(":disabled").trigger("change"),t.on("click",function(){var t=0,a=0;i.each(function(n,e){e=l(e);t+=parseFloat(e.val()),a+=e.data("max")}),(.5<t/a?i.not(":disabled").each(function(n,e){l(e).val(0)}):i.not(":disabled").each(function(n,e){e=l(e);e.val(e.data("max"))})).trigger("change")})}),this},{init:function(n){n.shipmentWidget()}}});