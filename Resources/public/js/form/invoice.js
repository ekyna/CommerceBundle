define(["jquery","ekyna-form/collection"],function(o){"use strict";return o.fn.invoiceWidget=function(){return this.each(function(){const e=o(this),t=e.find(".invoice-lines > tbody > tr input"),n=e.find("#toggle-quantities");console.log("invoiceWidget",t.length),t.on("blur",function(){const t=o(this),n=parseInt(t.val());isNaN(n)&&t.val(0).trigger("change")}).on("change keyup",function(){const t=o(this),n=e.find('.invoice-lines > tbody > tr input[data-parent="'+t.attr("id")+'"]');let i=parseInt(t.val());(i=isNaN(i)?0:i)>t.data("max")?t.closest("tr").addClass("has-error danger"):t.closest("tr").removeClass("has-error danger"),n.each(function(){const t=o(this);t.val(i*t.data("quantity")).trigger("change")})}),n.on("click",function(){let e=0,a=0;t.each(function(t,n){const i=o(n);e+=parseFloat(i.val()),a+=i.data("max")}),(.5<e/a?t.not(":disabled").each(function(t,n){o(n).val(0)}):t.not(":disabled").each(function(t,n){const i=o(n);i.val(i.data("max"))})).trigger("change")})}),this},{init:function(t){t.invoiceWidget()}}});