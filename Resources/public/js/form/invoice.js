define(["jquery","ekyna-form/collection"],function(e){"use strict";return e.fn.invoiceWidget=function(){return this.each(function(){var i=e(this),n=i.find(".invoice-lines > tbody > tr input"),t=i.find("#toggle-quantities");console.log("invoiceWidget",n.length),n.on("blur",function(){var n=e(this),t=parseInt(n.val());isNaN(t)&&n.val(0).trigger("change")}).on("change keyup",function(){var n=e(this),t=parseInt(n.val()),a=i.find('.invoice-lines > tbody > tr input[data-parent="'+n.attr("id")+'"]');(t=isNaN(t)?0:t)>n.data("max")?n.closest("tr").addClass("has-error danger"):n.closest("tr").removeClass("has-error danger"),a.each(function(){var n=e(this);n.val(t*n.data("quantity")).trigger("change")})}).not(":disabled").trigger("change"),t.on("click",function(){var a=0,i=0;n.each(function(n,t){t=e(t);a+=parseFloat(t.val()),i+=t.data("max")}),(.5<a/i?n.not(":disabled").each(function(n,t){e(t).val(0)}):n.not(":disabled").each(function(n,t){t=e(t);t.val(t.data("max"))})).trigger("change")})}),this},{init:function(n){n.invoiceWidget()}}});