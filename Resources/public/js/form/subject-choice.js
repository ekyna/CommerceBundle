define(["jquery","select2"],function(t){"use strict";return t.fn.subjectChoiceWidget=function(e){return e=t.extend({limit:8},e),this.each(function(){var e=t(this),n=!1,i=e.find(".provider"),a=e.find(".identifier"),r=e.find(".subject");i.is(":disabled")||(i.on("change",e=function(){var t,e;r.prop("disabled",!0).off("change"),a.val(null),n&&(r.select2("destroy"),n=!1),i.val()&&1===(e=i.find('option[value="'+i.val()+'"]')).length&&(t=e.data("config"))&&t.hasOwnProperty("search")&&((e=i.closest(".modal")).length||(e=null),r.prop("disabled",!1).select2({placeholder:"Rechercher ...",allowClear:!0,minimumInputLength:3,dropdownParent:e,ajax:{delay:300,url:t.search,dataType:"json",data:function(e){return{query:e.term,page:e.page,limit:10}},processResults:function(e,n){return n.page=n.page||1,{results:e.results,pagination:{more:n.page*t.limit<e.total_count}}},escapeMarkup:function(e){return e}}}).on("change",function(){a.val(r.val())}).trigger("change"),n=!0)}),e())}),this},{init:function(e){e.subjectChoiceWidget()}}});