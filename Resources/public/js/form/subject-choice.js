define(["jquery","routing","select2"],function(a,b){"use strict";return a.fn.subjectChoiceWidget=function(b){return b=a.extend({limit:8},b),this.each(function(){var b=a(this),c=!1,d=b.find(".provider"),e=b.find(".identifier"),f=b.find(".subject");if(!d.is(":disabled")){var g=function(){f.prop("disabled",!0).off("change"),e.val(null),c&&(f.select2("destroy"),c=!1);var a,b,g=d.val();if(g&&(a=d.find('option[value="'+d.val()+'"]'),1===a.size()&&(b=a.data("config"),b&&b.hasOwnProperty("search")))){var h=d.closest(".modal");h.size()||(h=null),f.prop("disabled",!1).select2({placeholder:"Rechercher ...",allowClear:!0,minimumInputLength:3,dropdownParent:h,ajax:{delay:300,url:b.search,dataType:"json",data:function(a){return{query:a.term,page:a.page,limit:10}},processResults:function(a,c){return c.page=c.page||1,{results:a.results,pagination:{more:c.page*b.limit<a.total_count}}},escapeMarkup:function(a){return a}}}).on("change",function(){e.val(f.val())}).trigger("change"),c=!0}};d.on("change",g),g()}}),this},{init:function(a){a.subjectChoiceWidget()}}});