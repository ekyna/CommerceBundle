define(["jquery","routing","ekyna-spinner"],function(a,b){function c(b){b.data("NewsletterQuickSubscription")||(b.data("NewsletterQuickSubscription",this),this.$element=b,this.$email=this.$element.find("input[type=email]"),this.key=this.$element.find("input[type=hidden]").val(),this.$element.on("click","button",a.proxy(this.subscribe,this)))}return c.prototype.subscribe=function(c){c.preventDefault(),c.stopPropagation();var d=String(this.$email.val());if(!d.length)return void this.$email.closest("div").addClass("has-error");this.$email.closest("div").removeClass("has-error"),this.$element.loadingSpinner("on");var e=this,f=a.ajax({url:b.generate("api_ekyna_commerce_newsletter_subscribe",{key:this.key}),method:"POST",data:{email:d},dataType:"json"});return f.done(function(a){a.success?(e.$email.val(""),e.$element.find(".success").show(),e.$element.find(".row").hide()):a.hasOwnProperty("errors")}),f.always(function(){e.$element.loadingSpinner("off")}),!1},{init:function(b){a(b).each(function(){new c(a(this))})}}});