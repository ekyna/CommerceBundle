define(["jquery","routing","ekyna-spinner"],function(i,n){function t(e){e.data("NewsletterQuickSubscription")||(e.data("NewsletterQuickSubscription",this),this.$element=e,this.$email=this.$element.find("input[type=email]"),this.key=this.$element.find("input[type=hidden]").val(),this.$element.on("click","button",i.proxy(this.subscribe,this)))}return t.prototype.subscribe=function(e){e.preventDefault(),e.stopPropagation();var t,e=String(this.$email.val());{if(e.length)return this.$email.closest("div").removeClass("has-error"),this.$element.loadingSpinner("on"),(e=i.ajax({url:n.generate("api_ekyna_commerce_newsletter_subscribe",{key:(t=this).key}),method:"POST",data:{email:e},dataType:"json"})).done(function(e){e.success?(t.$email.val(""),t.$element.find(".success").show(),t.$element.find(".row").hide()):e.hasOwnProperty("errors")}),e.always(function(){t.$element.loadingSpinner("off")}),!1;this.$email.closest("div").addClass("has-error")}},{init:function(e){i(e).each(function(){new t(i(this))})}}});